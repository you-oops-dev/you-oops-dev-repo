# Maintainer: Nonie <read_only@gmx.us>
#
# Contributor: Alley_Cat <read_only@gmx.us>
#
_pkgname="opera-proxy"
pkgname="opera-proxy-git"
pkgver=1.12.0.r0.g6ddb8d2
pkgrel=1
pkgdesc="Standalone Opera VPN client as http-proxy backend only"
arch=('i686' 'pentium4' 'x86_64' 'armv7h' 'aarch64')
url="https://github.com/Snawoot/opera-proxy"
license=('MIT')
depends=('bash')
makedepends=('git' 'go')
backup=('etc/default/opera-proxy')
source=("git+https://github.com/Snawoot/opera-proxy.git"
        opera-proxy.service
        opera-proxy-env)
sha512sums=('SKIP'
            'eb00fee03a3f716e6ee6a6b82b3d2ab669c454c3c235b73bee2816dc75c94040026ced30ac18a7cbe2b62fd4a6a39999d46b63daf558ccfef71b266d0c8d9b37'
            'ab09ce1313b1ae896d85a12f36f8eeef9b359dd5d520cde5999da2182de834e03a2ef5923b331c624fc61946715064d2bef93194281960d9cb15aa3cc7b9172a')

pkgver() {
  cd "$srcdir/$_pkgname"
  git describe --long --tags --abbrev=7 | sed 's/^v//;s/\([^-]*-g\)/r\1/;s/-/./g'
}

build() {
    cd "$srcdir/$_pkgname"
    if [[ "$CARCH" == "i686" ]]; then
        export GO386=softfloat
    fi
    make -s &>/dev/null
}

package() {
#    cd "$_pkgname"
    mkdir -p "$pkgdir"/usr/bin "$pkgdir"/usr/lib/systemd/system "$pkgdir"/usr/share/doc/opera-proxy "$pkgdir"/etc/default
    install -v -Dm755 "$srcdir"/$_pkgname/bin/opera-proxy "$pkgdir"/usr/bin/
    install -v -Dm644 "$srcdir/$_pkgname/README.md" "$pkgdir/usr/share/doc/opera-proxy/README"
    install -v -Dm644 ../opera-proxy.service "$pkgdir"/usr/lib/systemd/system/
    install -v -Dm644 ../opera-proxy-env "$pkgdir"/etc/default/opera-proxy
}

# vim:set ts=4 sw=2 ft=sh et:
